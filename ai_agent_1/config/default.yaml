# PPST Trading Agent Configuration
# OANDA credentials are in .env (not here)

instrument: EUR_USD
pip_value: 0.0001  # 1 pip = 0.0001 for EUR/USD (4th decimal)

# Timeframes to download/backtest
timeframes:
  - M1
  - M5

# PPST Indicator
ppst:
  pivot_period: 2
  atr_factor: 5    # Optimized: best risk-adjusted at 1.5% risk (7.02% avg weekly, 34.8% max DD)
  atr_period: 10

# Time Filter (PT timezone)
time_filter:
  use_quiet_window: false   # Optimized: no quiet window for best results
  quiet_start_hour: 13
  quiet_start_min: 30
  quiet_end_hour: 16
  quiet_end_min: 30
  use_market_window: true
  market_open_day: 6     # Sunday (Python weekday: 6)
  market_open_hour: 14
  market_close_day: 4    # Friday (Python weekday: 4)
  market_close_hour: 14

# Position Sizing
sizing:
  initial_capital: 10000.0
  risk_percent: 1.0          # Optimized: aggressive compound sizing
  max_position_units: 10000000  # Raised from 100K to allow proper compound sizing

# Spread
spread_pips: 1.5

# Volume Filter (for vol strategy signals)
volume_filter:
  sma_period: 20             # SMA lookback for relative volume (optimized from 30)
  threshold: 1.6             # Min vol ratio to allow signal entry (optimized from 1.0)

# Wick Cross SuperTrend Entry (WCSE)
# Alternative entry on vol-filtered signals via 3-candle pullback pattern
wcse:
  enabled: false
  entry_times: 1           # Max TP exits per swing (0=unlimited)
  c1_body_pips: 1.3        # 1st candle min body size
  c1_wick_pips: 5.0        # 1st candle wick proximity to ST
  c1_close_pips: 5.0       # 1st candle close proximity to ST
  c2_body_pips: 0.5        # 2nd candle min body size
  c2_wick_pips: 7.0        # 2nd candle wick proximity to ST
  c2_close_pips: 7.0       # 2nd candle close proximity to ST
  tp_rr: 1.2               # TP risk:reward ratio
  sl_buffer_pips: 0.0      # SL buffer beyond SuperTrend
  stop_buffer_pips: 0.5    # Buffer above c2.high for buy stop (below c2.low for sell stop)
  # Vol check: any candle in c0..c3 window >= main vol_threshold → pass
  # Override with vf_threshold to use a different threshold (0 = disabled)

# Wick Cross SuperTrend Entry 2 (WCSE2)
# Engulfing pattern near SuperTrend — runs alongside WCSE1
wcse2:
  enabled: false
  entry_times: 2           # Max TP exits per swing (0=unlimited)
  c_body_pips: 0.2         # Pre-engulfing candle min body size
  c_wick_pips: 3.0         # c1 wick proximity to ST
  c_close_pips: 3.0        # c1 close proximity to ST
  engulf_body_pips: 1.0    # Engulfing candle min body size
  tp_rr: 4.0               # TP risk:reward ratio
  sl_buffer_pips: 0.0      # SL buffer beyond SuperTrend
  # Vol check: any candle in c0..c3 window >= main vol_threshold → pass

# Signal Strategy (ppst_official_bt) - baseline, not recommended
signal_strategy:
  use_rr_tp: true
  rr_ratio: 1.5
  trail_with_supertrend: true
  only_long: false

# Circle Strategy (ppst_v1_bt) - BEST PERFORMING
circle_strategy:
  entry_mode: "Nth Circle"      # Optimized: Nth Circle entry mode
  entry_window_min: 30
  entry_circle_num: 1
  max_entry_dist_pips: 20.0     # Optimized: wider entry distance filter
  sl_buffer_pips: 1.0
  tp_type: "Risk Ratio"         # Optimized: RR-based TP
  tp_ratio: 2.0                 # Optimized: 2.0 RR ratio
  tp_fixed_pips: 30.0
  be_enabled: true
  be_trigger_pips: 10.0         # Optimized: tighter BE trigger
  be_offset_pips: 1.0           # Optimized: smaller BE offset
  trail_with_supertrend: true
  volume_filter_period: 20   # SMA lookback for relative volume
  volume_threshold: 0.0      # 0 = disabled, 1.5 = require 1.5x avg volume

# Huge Movement Trade Strategy (HMTS)
hmts:
  enable: true
  movement_req:
    num_candles: 10         # Max candles from S1 to S2
    pips: 60                # Min pip movement S1->S2
  revert_signal_req:
    num_candles: 6          # Max candles from S2 to S3
    min_pips: 10            # Min revert pips
    max_pips: 30            # Max revert pips (< this)
  hmts_sl:
    s1_init_sl_spread_buffer: true  # SL = SuperTrend +/- spread_pips
    s2_revert_cross_limit: 8       # During revert, if price crosses S1's ST by > N pips, close
  hmts_tp:
    s3_swing_tp_enable: true       # Always true: trail with S3's SuperTrend until crossed
    close_by_tp_rr: 7.0            # Pre-active TP at RR 7.0 from original SL distance. 0=disabled
  position:
    allow_second_entry: true       # Re-enter same dir after TP hit
  # Base signal behavior for non-HMTS signals
  base_rr_ratio: 1.5
  trail_with_supertrend: true

# VWAP Mean Reversion Strategy
vwap_strategy:
  session_start_utc: 8       # London open (08:00 UTC)
  vwap_band_mult: 1.5        # Std dev multiplier for VWAP bands
  rsi_period: 14             # RSI lookback period
  rsi_oversold: 30.0         # RSI threshold for long entries
  rsi_overbought: 70.0       # RSI threshold for short entries
  sl_pips: 15.0              # Fixed SL distance in pips
  tp_type: "vwap"            # "vwap", "opposite_band", or "rr"
  tp_rr: 1.5                 # RR ratio (used when tp_type=rr)

# VWAP Optimizer Grid
vwap_optimizer:
  session_starts: [8, 13]             # London (8) and NY (13) UTC
  vwap_band_mults: [1.0, 1.5, 2.0]
  rsi_periods: [7, 14]
  rsi_thresholds: [[30, 70], [25, 75]]
  sl_pips: [10, 15, 20]
  tp_types: ["vwap", "rr"]
  tp_rrs: [1.0, 1.5, 2.0]

# Optimizer Grid
optimizer:
  atr_factors: [3.0, 3.5, 3.75, 4.0, 4.5, 5.0]
  timeframes: [M1, M5]
  rr_ratios: [1.0, 1.5, 2.0, 2.5]
  tp_types: [rr, trailing, none]
  risk_percents: [1.0, 3.0, 5.0, 10.0, 15.0, 20.0]
  max_workers: 4

# Backtest
backtest:
  conservative_fills: true  # If both SL and TP within candle, assume SL hit

# Live Trading
live:
  poll_interval_seconds: 1
  max_candles_buffer: 500
  risk_percent: 1.5
  logs_dir: logs

# Performance Monitor (adaptive risk governor)
monitor:
  enabled: true
  baseline_risk: 1.5        # Normal risk % — never exceeds this
  min_risk: 0.5             # Floor risk % during DD danger
  dd_caution_threshold: 0.10  # 10% drawdown -> reduce to 0.75%
  dd_danger_threshold: 0.20   # 20% drawdown -> reduce to 0.5%
  gain_protect_threshold: 8.0  # 8%+ week return -> lock in gains at 0.75%
  gain_protect_risk: 0.75

# Best Configuration Summary (from optimization):
# Strategy: M5 Vol + WCSE1 Stop Order (config #5)
# VT=1.6, SMA=20, Buf=0.5, RR=1.2, ET=1, C1B=1.3, C2B=0.5
# C1W=5.0, C1C=5.0, C2W=7.0, C2C=7.0, Risk=1%, Spread=1.5
# Results: $10K -> $17,157 (+71.6%), Max DD 7.5%, Sharpe 5.90, PF 1.36, 392 trades
